services:
  # Backend WebSocket Server
  - type: web
    name: vision-backend
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile
    envVars:
      - key: USE_BROWSER_CAMERA
        value: "true"
      - key: YOLO_MODEL
        value: "yolo11l.pt"
      - key: YOLO_CONF
        value: "0.25"
      - key: USE_DEPTH_ESTIMATION
        value: "true"
      - key: VERTEX_PROJECT_ID
        sync: false
      - key: VERTEX_LOCATION
        value: "us-central1"
      - key: VERTEX_MODEL
        value: "gemini-2.0-flash-exp"
      - key: ELEVENLABS_API_KEY
        sync: false
      - key: ELEVENLABS_VOICE_ID
        sync: false
    healthCheckPath: /health

  # Frontend Static Site
  - type: static
    name: vision-frontend
    env: node
    buildCommand: cd ui && npm install && npm run build
    staticPublishPath: ./ui/build
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: REACT_APP_WS_URL
        fromService:
          type: web
          name: vision-backend
          envVarKey: RENDER_EXTERNAL_URL
